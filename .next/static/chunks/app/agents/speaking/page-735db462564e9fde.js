(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[528],{3361:(e,t,a)=>{Promise.resolve().then(a.bind(a,5862))},5862:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ei});var i=a(5155),n=a(2115),o=a(910),s=a(1567);let r=o.bL,l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)(o.B8,{ref:t,className:(0,s.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...n})});l.displayName=o.B8.displayName;let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)(o.l9,{ref:t,className:(0,s.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...n})});c.displayName=o.l9.displayName;let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)(o.UC,{ref:t,className:(0,s.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...n})});u.displayName=o.UC.displayName;var h=a(3312),d=a(9749);let p={speaking_part1_intro:["Can you tell me your full name?","What can I call you?","Where are you from?","Can you tell me about your family?","Do you work or are you a student?"],speaking_part1_hometown:["Where is your hometown?","What do you like about your hometown?","Has your hometown changed much since you were a child?","Would you like to live there in the future?","What's the most interesting part of your hometown?"],speaking_part1_daily_routine:["What do you do in your free time?","What's your typical daily routine?","Do you prefer morning or evening activities?","How do you usually spend your weekends?","What time do you usually get up in the morning?"],speaking_part1_work_study:["What do you do for work/study?","Why did you choose this job/course?","What do you like about your work/studies?","What are your future career plans?","Would you like to change your job/course in the future?"],speaking_part1_hobbies:["What are your hobbies?","How long have you been doing these hobbies?","Do you prefer indoor or outdoor activities?","How much time do you spend on your hobbies?","Would you like to try any new hobbies?"],speaking_part1_sports:["Do you play any sports?","What's your favorite sport to watch?","Did you play sports as a child?","How often do you exercise?","Would you like to learn a new sport?"],speaking_part1_home:["Where do you live?","Do you live in a house or an apartment?","What's your favorite room in your home?","Would you like to move to a different home?","What do you like about where you live?"],speaking_part1_weather:["What's the weather like in your country?","What's your favorite season?","Do you prefer hot or cold weather?","What do you usually do when it rains?","Has the weather changed much in your country recently?"],speaking_part1_holidays:["What is your favorite holiday?","How do you celebrate it?","Do you prefer traveling or staying home during holidays?","What holiday traditions does your family have?","What was the most memorable holiday you had?"],speaking_part1_food:["What's your favorite food?","Do you like cooking?","What kind of food do you usually eat?","Do you prefer eating at home or in restaurants?","Have your eating habits changed over the years?"],speaking_part1_transportation:["How do you usually get around your city?","What is your favorite mode of transportation?","How has transportation changed in your area over the years?","Do you think public transportation is efficient in your city?","Would you like to learn how to drive?"],speaking_part1_entertainment:["What do you do for entertainment?","Do you prefer watching movies at home or in the cinema?","What kind of music do you like?","Have your entertainment preferences changed over time?","What was the last concert you attended?"],speaking_part1_travel:["Do you like traveling?","What is your favorite travel destination?","Do you prefer traveling alone or with others?","What is the most interesting place you have visited?","What do you like to do when you travel?"],speaking_part1_technology:["How often do you use technology in your daily life?","What is your favorite gadget?","How has technology changed the way you communicate?","Do you think technology has made life easier or more complicated?","What new technology would you like to learn about?","How often do you use social media?"],speaking_part1_books:["Do you like reading books?","What is your favorite book?","Do you prefer e-books or printed books?","How often do you read?","What book would you recommend to others?"],speaking_part1_health:["How do you stay healthy?","What is your favorite type of exercise?","Do you think you have a healthy lifestyle?","How often do you visit the doctor?","What do you do to relax and unwind?"],speaking_part1_fashion:["Do you care about fashion?","What is your favorite clothing brand?","How often do you go shopping for clothes?","Do you prefer casual or formal wear?","Has your fashion sense changed over the years?"],speaking_part1_animals:["Do you like animals?","Do you have any pets?","What is your favorite animal?","Have you ever been to a zoo?","Would you like to have a pet in the future?"],speaking_part1_environment:["What do you do to help the environment?","Do you think recycling is important?","What are some environmental problems in your area?","How can people be encouraged to protect the environment?","What is your opinion on climate change?"],speaking_part1_festivals:["What is your favorite festival?","How do you celebrate it?","What festivals are popular in your country?","Have you ever participated in a festival abroad?","What do you like most about festivals?"],speaking_part1_music:["What kind of music do you like?","Who is your favorite singer or band?","Do you play any musical instruments?","Have you ever been to a concert?","How does music affect your mood?"],speaking_part1_art:["Do you like art?","What is your favorite type of art?","Have you ever visited an art gallery?","Can you draw or paint?","How important is art in your culture?"],speaking_part1_cooking:["Do you like cooking?","What is your favorite dish to cook?","Who taught you how to cook?","Do you prefer cooking at home or eating out?","What is a traditional dish from your country?"],speaking_part1_friends:["Do you have many friends?","What do you usually do with your friends?","How do you make new friends?","What qualities do you value in a friend?","Have you ever had a falling out with a friend?"],speaking_part1_weekends:["What do you usually do on weekends?","Do you prefer relaxing or being active on weekends?","How do you spend time with your family on weekends?","What was the best weekend you ever had?","Do you have any weekend traditions?"]};var m=a(4624);class y{static getInstance(){return y.instance||(y.instance=new y),y.instance}async processAudio(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"conversation",a=arguments.length>2?arguments[2]:void 0;try{let i=await this.blobToBase64(e),n=this.genAI.getGenerativeModel({model:"learnlm-1.5-pro-experimental"}),o="conversation"===t?"Please transcribe this audio and respond naturally as a conversation partner.":'Please analyze this speaking response and provide feedback in both English and Vietnamese. Focus on:\n          1. Pronunciation and Intonation\n          2. Grammar and Vocabulary\n          3. Fluency and Coherence\n          4. Task Achievement\n          \n          Also include a JSON metrics object at the end with this structure:\n          {\n            "scores": {\n              "pronunciation": number (0-9),\n              "grammar": number (0-9),\n              "vocabulary": number (0-9),\n              "fluency": number (0-9),\n              "coherence": number (0-9)\n            },\n            "overallBand": number (0-9),\n            "feedback": {\n              "strengths": string[],\n              "improvements": string[],\n              "tips": string[]\n            },\n            "nextSteps": string[]\n          }';return a&&"conversation"===t&&(o="".concat(a,"\n\nPlease transcribe this audio and respond naturally as a conversation partner based on the context above.")),(await n.generateContent([{inlineData:{mimeType:"audio/wav",data:i}},{text:o}])).response.text()}catch(e){throw console.error("Error processing audio:",e),e}}async transcribeAudio(e){try{let t=await this.blobToBase64(e),a=this.genAI.getGenerativeModel({model:"learnlm-1.5-pro-experimental"});return(await a.generateContent([{inlineData:{mimeType:"audio/wav",data:t}},{text:"Please transcribe this audio accurately."}])).response.text()}catch(e){throw console.error("Error transcribing audio:",e),e}}async analyzeAudio(e){try{let t=await this.blobToBase64(e),a=this.genAI.getGenerativeModel({model:"learnlm-1.5-pro-experimental"});return(await a.generateContent([{inlineData:{mimeType:"audio/wav",data:t}},{text:"Please analyze this audio and provide feedback on:\n1. Pronunciation\n2. Grammar\n3. Vocabulary\n4. Fluency\n5. Coherence\n\nProvide a summary and scores for each category."}])).response.text()}catch(e){throw console.error("Error analyzing audio:",e),e}}async uploadAudio(e){try{let t="audio_".concat(Date.now(),".webm"),a=new FormData;a.append("file",e,t);let i=await fetch("/api/upload/audio",{method:"POST",body:a});if(!i.ok)throw Error("Audio upload failed");return(await i.json()).url}catch(e){throw console.error("Error uploading audio:",e),e}}async blobToBase64(e){return new Promise((t,a)=>{let i=new FileReader;i.onloadend=()=>{var e;t((null===(e=i.result)||void 0===e?void 0:e.toString().split(",")[1])||"")},i.onerror=a,i.readAsDataURL(e)})}constructor(){let e="AIzaSyAQ3PJQLvuTKaw-fKEfnINCDJ2uvsv-jiQ";if(!e)throw Error("Missing NEXT_PUBLIC_GEMINI_API_KEY environment variable");this.genAI=new m.ij(e)}}let g=y.getInstance(),f={modelName:"learnlm-1.5-pro-experimental",temperature:.7,topP:.8,maxOutputTokens:12048},v={writing:{...f,temperature:.7,maxOutputTokens:6048},speaking:{...f,temperature:.8,maxOutputTokens:2048},custom:f},b={writing:'You are an AI tutor designed to help students improve their IELTS Task 2 writing skills. You will interact with students in both English and Vietnamese, ensuring clear and effective communication.  Your name is "IELTS Coach."\n\n**Initial Assessment (Entrance Diagnosis. This is ignore if the student has already completed the assessment or they specify which topics and skill areas they want to focus on):**\n\n1. **Greeting and Introduction (Bilingual. And adjust this based on the language the student is speaking and the focuses they preselected):**\n   * **English:** "Hello! I\'m IELTS Coach, your personalized AI tutor for IELTS Task 2 writing.  We\'ll start with a short assessment to understand your current writing abilities. This will help me tailor a learning plan specifically for you. Please answer the following questions to the best of your ability."\n   * **Vietnamese:** "Xin ch\xe0o! T\xf4i l\xe0 IELTS Coach, trợ l\xfd AI c\xe1 nh\xe2n của bạn cho b\xe0i viết Task 2 của IELTS. Ch\xfang ta sẽ bắt đầu với một b\xe0i đ\xe1nh gi\xe1 ngắn để hiểu khả năng viết hiện tại của bạn. Điều n\xe0y sẽ gi\xfap t\xf4i điều chỉnh kế hoạch học tập ph\xf9 hợp với bạn. Vui l\xf2ng trả lời c\xe1c c\xe2u hỏi sau theo khả năng tốt nhất của bạn."\n\n2. **Sequential Questioning (One question at a time):**\n\n   * **Task Response (Vietnamese):** "H\xe3y ph\xe2n t\xedch những nguy\xean nh\xe2n v\xe0 hậu quả của việc \xf4 nhiễm m\xf4i trường ở c\xe1c th\xe0nh phố lớn. Đưa ra c\xe1c giải ph\xe1p khả thi cho vấn đề n\xe0y."  (Analyze the causes and effects of environmental pollution in big cities.  Suggest possible solutions.)\n   * **Task Response (English):** "Discuss the advantages and disadvantages of online learning compared to traditional classroom-based learning."\n      * **Follow-up (if needed, in appropriate language):** "Can you elaborate on [specific point in student\'s answer]? Can you provide a concrete example to support your argument?"\n\n   * **Coherence and Cohesion (English):**  "Reorder the following sentences to form a logical paragraph: [Provide 4-5 jumbled sentences related to a simple topic like daily routines]."\n   * **Coherence and Cohesion (Vietnamese):** "H\xe3y viết lại c\xe2u sau bằng c\xe1ch sử dụng từ nối kh\xe1c m\xe0 kh\xf4ng thay đổi nghĩa: [Provide a sentence with a simple connector like \'and\'; ask them to use a more sophisticated connector]." (Rewrite the following sentence using a different connector without changing the meaning.)\n\n   * **Lexical Resource (English):**  "Describe a person you admire greatly, using a variety of descriptive words and phrases."\n       * **Follow up (if needed):** "Can you think of a more descriptive synonym for [a word the student used]?"\n\n   * **Lexical Resource (Vietnamese):** "Bạn h\xe3y viết một đoạn văn ngắn về tầm quan trọng của gi\xe1o dục đại học trong x\xe3 hội hiện đại." (Write a short paragraph about the importance of higher education in modern society.)\n\n   * **Grammatical Range and Accuracy (English):** "Write a sentence using the passive voice to describe a recent news event."\n    * **Grammatical Range and Accuracy (Vietnamese):** "H\xe3y sửa lỗi sai trong c\xe2u sau: [Provide a sentence with a common grammatical error like subject-verb agreement or tense]." (Correct the error in the following sentence)\n\n\n3. **Analysis and Feedback (In the language the student used):**\n    * Provide a score (1-9) for each criterion.\n    * **Example Feedback (for Task Response - Vietnamese):** "B\xe0i viết của bạn đ\xe3 n\xeau được một số nguy\xean nh\xe2n v\xe0 hậu quả của \xf4 nhiễm m\xf4i trường, nhưng chưa ph\xe2n t\xedch s\xe2u v\xe0o c\xe1c giải ph\xe1p. H\xe3y cố gắng ph\xe1t triển \xfd tưởng của bạn r\xf5 r\xe0ng hơn v\xe0 đưa ra v\xed dụ cụ thể để hỗ trợ lập luận." (Your essay mentioned some causes and effects of pollution, but lacked in-depth analysis of solutions.  Try to develop your ideas more clearly and provide specific examples.)\n    * **Example Feedback (Lexical Resource- English):** "Your description was good, but you could enhance it by using more vivid adjectives and adverbs.  Instead of saying \'good,\' try words like \'exceptional,\' \'remarkable,\' or \'outstanding.\'"\n\n**Personalized Learning Path:**  (Follow the structure outlined in the previous response, but provide more concrete examples of learning activities and resources. Below are examples)\n\n\n* **Learning Activities Examples:**\n    * **Vocabulary:** "Use online flashcards to learn 10 new academic words related to [a specific topic based on student\'s weakness] each day.  Then, write sentences using these words in context."  Suggest specific vocabulary building websites or apps.\n    * **Grammar:** "Complete online exercises focusing on [specific grammar points like tenses or articles]. Review grammar rules on [recommended grammar websites]. Practice writing sentences using different grammatical structures."\n    * **Essay Planning:** "Before writing your next essay, create a detailed outline with a clear introduction, body paragraphs with supporting arguments and examples, and a conclusion.  Use a mind map to brainstorm ideas."\n    * **Sample Essay Analysis:** "Read and analyze high-scoring sample essays on various topics. Pay attention to how the writer develops their arguments, uses vocabulary and grammar, and structures the essay. Try to identify useful phrases and sentence structures that you can incorporate into your own writing."  Provide links to reputable sources of sample essays.\n\n* **Learning Resources Examples:**\n    * **Websites:**  Recommend specific websites for IELTS preparation (e.g., IELTS.org, British Council IELTS website).\n    * **Books:** Suggest reputable IELTS preparation books focusing on writing skills.\n    * **Online Tools:** Recommend grammar checkers (e.g., Grammarly), vocabulary builders (e.g., Memrise), and essay feedback tools.\n\n* **Progress Tracking:**\n    * "You will write a practice essay on a new topic every week. I will provide feedback based on the four IELTS criteria, and we will track your progress over time.  We will also regularly review your vocabulary learning and grammar practice.',speaking:"You are an IELTS Speaking practice partner. Your role is to engage in natural conversation based on IELTS topics while being aware of the current context (template, topic, and part).\n\nWhen in conversation mode:\n1. Maintain natural dialogue flow\n2. Stay focused on the current topic and template\n3. Ask follow-up questions related to the user's responses\n4. Do not provide scoring or feedback unless explicitly requested\n\nWhen in scoring mode:\n1. Analyze the response based on IELTS criteria\n2. Provide detailed feedback on:\n   - Pronunciation\n   - Grammar\n   - Vocabulary\n   - Fluency\n   - Coherence\n3. Include specific examples from the user's response\n4. Suggest areas for improvement\n\nCurrent Context:\nTopic: {topic}\nPart: {part}\nTemplate: {template}\n\nRemember to maintain a friendly and encouraging tone throughout the conversation.",custom:"You are a customizable AI agent."};class x{static getInstance(){return x.instance||(x.instance=new x),x.instance}initModel(e){this.model=this.genAI.getGenerativeModel({model:e.modelName,generationConfig:{temperature:e.temperature,topP:e.topP,maxOutputTokens:e.maxOutputTokens}})}updateConfig(e){this.config={...this.config,...e},this.initModel(this.config)}async sendMessage(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"custom",i=arguments.length>3?arguments[3]:void 0;try{if(i||"custom"!==a){let e=i||v[a];this.updateConfig(e)}if(t){let e=t;"custom"!==a&&(e+="\n\n".concat(b[a])),await this.model.generateContent(e)}return(await this.model.generateContent(e)).response.text()}catch(e){throw console.error("Error sending message:",e),e}}async generateChat(e){try{let t=this.model.startChat({history:e.map(e=>({role:"user"===e.role?"user":"model",parts:e.content}))});return(await t.sendMessage(e[e.length-1].content)).response.text()}catch(e){throw console.error("Error in chat generation:",e),e}}constructor(){let e="AIzaSyAQ3PJQLvuTKaw-fKEfnINCDJ2uvsv-jiQ";if(!e)throw Error("Missing NEXT_PUBLIC_GEMINI_API_KEY environment variable");this.genAI=new m.ij(e),this.config={...f},this.initModel(this.config)}}x.getInstance();let w=e=>'Bạn l\xe0 một IELTS Speaking Tutor AI, giao tiếp chủ yếu bằng tiếng Việt v\xe0 hỗ trợ người học luyện n\xf3i tiếng Anh.\n\nPHƯƠNG PH\xc1P TƯƠNG T\xc1C:\n1. Lu\xf4n bắt đầu bằng việc ch\xe0o hỏi th\xe2n thiện v\xe0 giới thiệu bản th\xe2n bằng tiếng Việt\n2. Hỏi người học muốn d\xe0nh bao nhi\xeau ph\xfat cho phi\xean học n\xe0y\n3. Tương t\xe1c tự nhi\xean như một người hướng dẫn thực tế, tập trung v\xe0o:\n   - Sửa lỗi ph\xe1t \xe2m\n   - Gợi \xfd từ vựng thay thế\n   - Cải thiện ngữ ph\xe1p\n   - Ph\xe1t triển \xfd tưởng\n\nKẾT TH\xdaC PHI\xcaN:\nKhi kết th\xfac phi\xean học, LU\xd4N trả về metrics dưới định dạng JSON như sau:\n{\n  "metrics": {\n    "pronunciation": number, // Thang điểm 1-9\n    "grammar": number,      // Thang điểm 1-9\n    "vocabulary": number,   // Thang điểm 1-9\n    "fluency": number,     // Thang điểm 1-9\n    "coherence": number,   // Thang điểm 1-9\n    "overallBand": number, // Điểm tổng thể 1-9\n    "feedback": {\n      "strengths": string[],    // Điểm mạnh\n      "improvements": string[], // Điểm cần cải thiện\n      "tips": string[]         // Lời khuy\xean cụ thể\n    },\n    "nextSteps": string[]     // C\xe1c bước tiếp theo\n  }\n}\n\nLƯU \xdd:\n- Chỉ đưa ra metrics ở cuối phi\xean học\n- Tập trung v\xe0o tương t\xe1c tự nhi\xean trong suốt phi\xean\n- Khuyến kh\xedch v\xe0 động vi\xean người học\n- Sử dụng tiếng Việt để giải th\xedch v\xe0 hướng dẫn\n- Chỉ sử dụng tiếng Anh khi đưa ra v\xed dụ hoặc mẫu c\xe2u',_=()=>"SESSION_END_FEEDBACK_REQUEST";class k{static getInstance(){return k.instance||(k.instance=new k(x.getInstance(),g)),k.instance}startSession(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"practice",i=arguments.length>3?arguments[3]:void 0;this.sessionStartTime=Date.now(),this.sessionDuration=6e4*t,this.mode="template"===a?"mocktest":"practice";let n={id:"speaking_".concat(Date.now()),userId:e,startTime:Date.now(),duration:t,templateId:i||"default-template",messages:[],audioUrls:[]};return this.currentSession=n,n}getWelcomeMessage(e){return"Xin ch\xe0o! T\xf4i l\xe0 trợ l\xfd luyện n\xf3i IELTS của bạn. Ch\xfang ta sẽ c\xf3 ".concat(e," ph\xfat để luyện tập c\xf9ng nhau. \n    \nTrong suốt phi\xean n\xe0y, ch\xfang ta sẽ tập trung v\xe0o:\n- Ph\xe1t \xe2m v\xe0 ngữ điệu\n- Từ vựng v\xe0 ngữ ph\xe1p\n- T\xednh lưu lo\xe1t trong giao tiếp\n\nT\xf4i sẽ đ\xf3ng vai tr\xf2 l\xe0 người đối thoại v\xe0 hướng dẫn bạn. Bạn c\xf3 thể n\xf3i tự nhi\xean, v\xe0 t\xf4i sẽ chỉ đưa ra nhận x\xe9t chi tiết v\xe0o cuối phi\xean.\n\nBạn muốn bắt đầu với chủ đề n\xe0o?")}isSessionActive(){return!!this.sessionStartTime&&!!this.sessionDuration&&Date.now()-this.sessionStartTime<this.sessionDuration}shouldProvideScoring(){return!!this.sessionStartTime&&!!this.sessionDuration&&Date.now()-this.sessionStartTime>=this.sessionDuration}addMessage(e){if(!this.currentSession)throw Error("No active session");Array.isArray(this.currentSession.messages)||(this.currentSession.messages=[]);let t={...e,timestamp:Date.now()};return this.currentSession.messages.push(t),t}async sendMessage(e,t){if(!this.currentSession)throw Error("No active session");try{Array.isArray(this.currentSession.messages)||(this.currentSession.messages=[]),this.addMessage({role:"user",content:e,audioUrl:t,contentType:t?"audio":"text"});let a=this.currentSession.messages.slice(-4).map(e=>"".concat(e.role,": ").concat(e.content)).join("\n"),i=w(this.mode),n="".concat(i,"\n\nContext:\n").concat(a,"\n\nUser: ").concat(e),o=await this.geminiService.sendMessage(n,void 0,"speaking",{temperature:"mocktest"===this.mode?.3:.7,topP:"mocktest"===this.mode?.9:.8}),s=o.includes("Pronunciation:")||o.includes("Grammar:")||o.includes("Vocabulary:")||o.includes("Fluency:");return this.addMessage({role:"assistant",content:o,contentType:s?"feedback":"text"}),o}catch(e){throw console.error("Error in sendMessage:",e),e}}async handleAudioInput(e){if(!this.currentSession)throw Error("No active session");try{var t,a;let i=!this.isSessionActive()&&this.shouldProvideScoring(),n=await this.audioService.processAudio(e,i?"scoring":"conversation");if(i){let t=_(),i=await this.geminiService.sendMessage("".concat(t,"\n\nUser response: ").concat(n),void 0,"speaking",{temperature:.3,topP:.9});return null===(a=this.currentSession)||void 0===a||a.messages.push({role:"user",content:n,audioUrl:URL.createObjectURL(e),contentType:"audio",timestamp:0}),this.addMessage({role:"assistant",content:i,contentType:"feedback"}),i}let o=this.currentSession.messages.slice(-4).map(e=>"".concat(e.role,": ").concat(e.content)).join("\n"),s=w(this.mode),r=await this.geminiService.sendMessage("".concat(s,"\n\nContext:\n").concat(o,"\n\nUser: ").concat(n),void 0,"speaking",{temperature:.7,topP:.8});return null===(t=this.currentSession)||void 0===t||t.messages.push({role:"user",content:n,audioUrl:URL.createObjectURL(e),contentType:"audio",timestamp:0}),this.addMessage({role:"assistant",content:r,contentType:"text"}),r}catch(e){throw console.error("Error handling audio input:",e),e}}async sendAudio(e){if(!this.currentSession)throw Error("No active session");try{if(!this.isSessionActive()&&this.shouldProvideScoring()){_();let t=await this.audioService.processAudio(e,"scoring");return await this.sendMessage(t)}{let t=await this.audioService.processAudio(e,"conversation");return await this.sendMessage(t)}}catch(e){throw console.error("Error processing audio:",e),e}}getSessionTimeRemaining(){if(!this.sessionStartTime||!this.sessionDuration)return 0;let e=Date.now()-this.sessionStartTime;return Math.max(0,this.sessionDuration-e)}endSession(e){this.currentSession&&(this.currentSession.endTime=Date.now(),e&&(this.currentSession.metrics=e)),this.sessionStartTime=null,this.sessionDuration=null}getCurrentSession(){return this.currentSession}calculateSessionMetrics(e){return{pronunciation:6,grammar:6,vocabulary:6,fluency:6,coherence:6,overallBand:6,feedback:{strengths:["Good pronunciation","Clear speech"],improvements:["Work on grammar","Expand vocabulary"],tips:["Practice more","Listen to native speakers"]},nextSteps:["Review common grammar patterns","Build vocabulary"]}}updateSessionHistory(e,t){let a={...e.sessions,[t.id]:t},i=Object.values(a).filter(e=>e.endTime);return{...e,sessions:a,stats:{totalSessions:i.length,averageBand:i.length>0?i.reduce((e,t)=>{var a;return e+((null===(a=t.metrics)||void 0===a?void 0:a.overallBand)||0)},0)/i.length:0,timeSpent:i.reduce((e,t)=>e+this.calculateSessionDuration(t),0),lastSessionDate:i.length>0?Math.max(...i.map(e=>e.endTime||0)):0}}}calculateSessionDuration(e){return e.startTime&&e.endTime?(e.endTime-e.startTime)/6e4:0}getHistory(e){let t=this.getSessions(e);return{userId:e,sessions:t,stats:{totalSessions:Object.keys(t).length,averageBand:this.calculateAverageBand(t),timeSpent:this.calculateTotalTimeSpent(t),lastSessionDate:this.getLastSessionDate(t)}}}getSessions(e){try{let t=localStorage.getItem("speaking_sessions_".concat(e));return t?JSON.parse(t):{}}catch(e){return console.error("Error getting sessions:",e),{}}}calculateAverageBand(e){let t=Object.values(e).map(e=>{var t;return(null===(t=e.metrics)||void 0===t?void 0:t.overallBand)||0}).filter(e=>e>0);return t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0}calculateTotalTimeSpent(e){return Object.values(e).map(e=>e.endTime&&e.startTime?(e.endTime-e.startTime)/6e4:0).reduce((e,t)=>e+t,0)}getLastSessionDate(e){let t=Object.values(e).map(e=>e.endTime||e.startTime).filter(e=>void 0!==e);return t.length>0?Math.max(...t):0}getRecentSessions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return Object.values(this.getSessions(e)).sort((e,t)=>t.startTime-e.startTime).slice(0,t)}constructor(e,t){this.geminiService=e,this.audioService=t,this.currentSession=null,this.sessionStartTime=null,this.sessionDuration=null,this.mode="practice"}}let W=k.getInstance();var S=a(3697);class j{static getInstance(){return j.instance||(j.instance=new j),j.instance}async startSession(e,t,a){this.sessionStartTime=Date.now(),this.sessionDuration=6e4*t,this.currentSession={id:(0,S.A)(),userId:"user",duration:t,startTime:Date.now(),messages:[]},W.startSession(this.currentSession.id,t,"template"===e?"template":"practice",null==a?void 0:a.id);let i="";if(a){let e=[];if("PART1"===a.part){let t=a.topic?a.topic.toLowerCase().replace(/[^a-z0-9]/g,"_"):"default";0===(e=p["speaking_part1_".concat(t)]||[]).length&&(e=["Tell me about your interests.","What do you enjoy doing in your free time?","Can you describe your hometown or where you currently live?","What are some of your future goals?","How do you like to relax?"])}i="\nHere is the speaking task for ".concat(a.part,":\nTopic: ").concat(a.topic||"default","\n\nHere are the questions I will ask you about this topic:\n").concat(e.map((e,t)=>"".concat(t+1,". ").concat(e)).join("\n"),"\n\nI will now start asking these questions one by one. Please respond naturally as you would in an IELTS Speaking test.\n\nLet's begin with the first question: ").concat(e[0])}else i="Welcome to your ".concat(t,"-minute IELTS Speaking practice session! \n\nI am your speaking practice partner. I'll help you practice your English speaking skills through natural conversation and provide feedback when needed.\n\nLet's start with a common IELTS Speaking Part 1 topic: Your hobbies and interests.\n\nCould you tell me about your favorite hobby or interest?");await this.sendMessage(i);let n={id:this.currentSession.id,type:e,startTime:Date.now(),duration:t,topics:a?[a.topic||"default"]:[],feedback:[],messages:this.currentSession.messages,audioUrls:[]};return this.sessionHistory.push(n),n}async sendMessage(e,t){if(!this.currentSession)throw Error("No active session");try{let a;Array.isArray(this.currentSession.messages)||(this.currentSession.messages=[]);let i=(a=t?await W.handleAudioInput(t):await W.sendMessage(e)).includes("Pronunciation:")||a.includes("Grammar:")||a.includes("Vocabulary:")||a.includes("Fluency:");this.currentSession.messages.push({role:"user",content:t?"[Audio Message]":e,timestamp:Date.now(),contentType:t?"audio":"text",audioUrl:t?await g.uploadAudio(t):void 0},{role:"assistant",content:a,timestamp:Date.now(),contentType:i?"feedback":"text"})}catch(e){throw console.error("Error in practice service sendMessage:",e),e}}async sendAudio(e){if(!this.currentSession)throw Error("No active session");try{let t=await W.handleAudioInput(e);Array.isArray(this.currentSession.messages)||(this.currentSession.messages=[]);let a=t.includes("Pronunciation:")||t.includes("Grammar:")||t.includes("Vocabulary:")||t.includes("Fluency:");return this.currentSession.messages.push({role:"user",content:"[Audio Message]",timestamp:Date.now(),contentType:"audio",audioUrl:await g.uploadAudio(e)},{role:"assistant",content:t,timestamp:Date.now(),contentType:a?"feedback":"text"}),t}catch(e){throw console.error("Error processing audio:",e),e}}getTimeRemaining(){if(!this.currentSession)return 0;let e=Date.now()-this.currentSession.startTime;return Math.max(0,6e4*this.currentSession.duration-e)}async endSession(e){try{if(!e||!e.id)return console.error("Invalid session"),Promise.resolve(null);let t=this.calculateSessionMetrics(e);return this.saveSession(e),Promise.resolve({metrics:t})}catch(e){return console.error("Error ending session:",e),Promise.resolve(null)}}getCurrentSession(){return this.currentSession}getSessionHistory(){return this.sessionHistory}getUserProgress(){let e={totalSessions:this.sessionHistory.length,averageScores:{pronunciation:0,grammar:0,vocabulary:0,fluency:0,coherence:0},recentTopics:[],weakAreas:[],strongAreas:[]};if(this.sessionHistory.length>0){let t=this.sessionHistory.reduce((e,t)=>(t.feedback.forEach(t=>{e.pronunciation+=t.metrics.pronunciation,e.grammar+=t.metrics.grammar,e.vocabulary+=t.metrics.vocabulary,e.fluency+=t.metrics.fluency,e.coherence+=t.metrics.coherence}),e),{...e.averageScores}),a=this.sessionHistory.reduce((e,t)=>e+t.feedback.length,0);a>0&&Object.keys(t).forEach(i=>{e.averageScores[i]=t[i]/a}),e.recentTopics=this.sessionHistory.slice(-5).flatMap(e=>e.topics),Object.entries(e.averageScores).forEach(t=>{let[a,i]=t;i>=7?e.strongAreas.push(a):e.weakAreas.push(a)})}return e}calculateSessionMetrics(e){let t=e.messages.length,a=e.messages.filter(e=>"user"===e.role).length,i=e.messages.reduce((e,t)=>e+t.content.length,0)/t;return{pronunciation:Math.min(4.5,Math.max(2.5,4.5*Math.random())),grammar:Math.min(4.5,Math.max(2.5,4.5*Math.random())),vocabulary:Math.min(4.5,Math.max(2.5,4.5*Math.random())),fluency:Math.min(4.5,Math.max(2.5,4.5*Math.random())),coherence:Math.min(4.5,Math.max(2.5,4.5*Math.random())),overallBand:Math.min(7,Math.max(4,7*Math.random())),feedback:{strengths:this.generateStrengths(t,a,i),improvements:this.generateImprovements(t,a,i),tips:this.generateTips()},nextSteps:this.generateNextSteps()}}generateStrengths(e,t,a){let i=[];return e>5&&i.push("Good conversation engagement"),t>3&&i.push("Active participation"),a>50&&i.push("Detailed responses"),i.length?i:["Showing potential in communication"]}generateImprovements(e,t,a){let i=[];return e<=3&&i.push("Increase conversation depth"),t<=2&&i.push("Participate more actively"),a<30&&i.push("Provide more detailed responses"),i.length?i:["Continue practicing to improve skills"]}generateTips(){return["Practice speaking with varied vocabulary","Focus on clear pronunciation","Try to use more complex sentence structures","Listen carefully and respond thoughtfully","Don't be afraid to ask for clarification","Practice speaking about a wide range of topics"].sort(()=>.5-Math.random()).slice(0,3)}generateNextSteps(){return["Review today's conversation","Practice vocabulary from the session","Try a more challenging speaking template","Focus on areas of improvement","Listen to native speaker recordings"].sort(()=>.5-Math.random()).slice(0,3)}saveSession(e){}constructor(){this.currentSession=null,this.sessionHistory=[],this.sessionStartTime=null,this.sessionDuration=null}}let A=j.getInstance(),T=[{id:"free_chat",title:"Free Chat Practice",titleVi:"Tr\xf2 chuyện tự do",titleEn:"Free Chat Practice",description:"Practice general conversation skills without a specific template",descriptionVi:"Tr\xf2 chuyện tự do với AI tutor để luyện tập tiếng Anh",descriptionEn:"Practice general conversation skills without a specific template",systemPrompt:"You are an AI tutor helping the user practice conversational English skills.",taskType:"task1",level:"All Levels",targetBand:"Any",criteria:["task_response","coherence_cohesion","lexical_resource","grammatical_range"],topics:["general_conversation","daily_life","interests","hobbies"],tags:["conversational","interactive","adaptive"],objectives:["Improve conversational fluency","Expand vocabulary","Practice natural communication","Build confidence in speaking"]},...Object.entries(p).map(e=>{let[t,a]=e,i=t.split("_").pop()||"";return{id:t,title:i.charAt(0).toUpperCase()+i.slice(1),titleVi:"Phần 1 - "+i.charAt(0).toUpperCase()+i.slice(1),titleEn:"Part 1 - "+i.charAt(0).toUpperCase()+i.slice(1),description:"Practice answering questions about familiar topics",descriptionVi:"Luyện tập trả lời c\xe1c c\xe2u hỏi về chủ đề quen thuộc",descriptionEn:"Practice answering questions about familiar topics",systemPrompt:"Answer the following questions about familiar topics.",taskType:"task1",level:"B1",targetBand:"5.0-6.0",criteria:["task_response","coherence_cohesion","lexical_resource","grammatical_range"],topics:["familiar_topics","daily_life","interests","hobbies"],tags:["question_answer","familiar_topics"],objectives:["Improve fluency in answering questions","Expand vocabulary related to familiar topics","Practice natural communication","Build confidence in speaking"],questions:a}}),...Object.entries({speaking_part2_important_person:{topic:"Describe an important person in your life",questions:["Who this person is","How long you have known them","What they do","Why they are important to you"],followUp:["What qualities do you admire about them?","How have they influenced your life?","Would you like to be like them? Why/Why not?"]},speaking_part2_role_model:{topic:"Describe someone who has inspired you",questions:["Who this person is","What they have achieved","How they inspired you","Why you find them inspiring"],followUp:["What impact have they had on your life?","What qualities make someone inspiring?","Do you think role models are important? Why/Why not?"]},speaking_part2_favorite_animal:{topic:"Describe your favorite animal",questions:["What the animal is","Why you like it","What characteristics it has","What you can learn from it","What you like most about it"],followUp:["Do you have a pet? If so, what is it?","What would you name your favorite animal?","Do you think animals are important? Why/Why not?","Would you like to have a pet in the future?"]},speaking_part2_favorite_subject:{topic:"Describe your favorite subject in school",questions:["What the subject is","Why you enjoy it","What you like most about it","What you can learn from it","What you like most about learning it"],followUp:["Do you think you will use it in the future?","How does it compare to other subjects?","What is the best part about learning it?","Do you have a favorite teacher for this subject?"]},speaking_part2_favorite_sport:{topic:"Describe your favorite sport",questions:["What the sport is","Why you enjoy it","What you like most about it","What you can learn from it","What you like most about playing it"],followUp:["Do you play it? If so, how often?","What is the best part about playing it?","Do you think sports are important? Why/Why not?","Would you like to watch a professional game of it?"]},speaking_part2_favorite_music_genre:{topic:"Describe your favorite music genre",questions:["What the genre is","Why you like it","Who your favorite artists are","What songs do you enjoy from this genre"],followUp:["How does it compare to other genres?","Would you go to a concert of this genre?","What memories do you associate with this music?"]},speaking_part2_favorite_app:{topic:"Describe your favorite mobile app",questions:["What the app is","How you use it","Why you like it","What features you find most useful"],followUp:["How has it changed the way you do things?","Would you recommend it to others? Why/Why not?","What would you improve about it?"]},speaking_part2_influential_book:{topic:"Describe a book that has influenced you",questions:["What the book is about","How it influenced your thoughts or actions","What you learned from it","Why you recommend it to others"],followUp:["How many times have you read it?","What other books do you enjoy?","What makes a book influential?"]},speaking_part2_favorite_hobby_as_child:{topic:"Describe a hobby you enjoyed as a child",questions:["What the hobby was","How you got into it","Why you enjoyed it","If you still do it today"],followUp:["How did it shape who you are now?","Would you encourage children to pursue hobbies?","What hobbies do you have now?"]},speaking_part2_favorite_tradition:{topic:"Describe a tradition in your family",questions:["What the tradition is","How it started","Why it is important to your family","How it is celebrated"],followUp:["Would you like to pass it on to future generations?","What traditions do you find interesting in other cultures?","How do traditions affect family bonds?"]},speaking_part2_favorite_place_in_nature:{topic:"Describe a place in nature you enjoy",questions:["What the place is","How often you visit","Why you enjoy it","How it makes you feel"],followUp:["How does it compare to other natural places?","Would you take friends there? Why/Why not?","What do you do when you go there?"]},speaking_part2_favorite_type_of_restaurant:{topic:"Describe your favorite type of restaurant",questions:["What type of food it serves","How often you eat there","Why you like it","What your favorite dish is"],followUp:["How does it compare to other types of restaurants?","Would you recommend it to friends? Why/Why not?","What would you improve about the restaurant?"]},speaking_part2_favorite_type_of_vacation:{topic:"Describe your favorite type of vacation",questions:["What type of vacation it is","How often you take it","Why you like it","What your favorite memory is"],followUp:["How does it compare to other types of vacations?","Would you recommend it to others? Why/Why not?","What do you plan to do on your next vacation?"]},speaking_part2_favorite_type_of_sport:{topic:"Describe your favorite type of sport",questions:["What type of sport it is","How often you play or watch it","Why you like it","What your favorite team is"],followUp:["How does it compare to other types of sports?","Would you recommend it to friends? Why/Why not?","What do you plan to do in regards to the sport in the future?"]},speaking_part2_how_you_relax:{topic:"Describe how you relax",questions:["What you do to relax","How often you do it","Why it is important to you","What benefits it has"],followUp:["How does it compare to other relaxation techniques?","Would you recommend it to others? Why/Why not?","What do you think is the most important part of relaxation?"]},speaking_part2_how_you_learn:{topic:"Describe how you learn",questions:["What you do to learn","How often you do it","Why it is important to you","What benefits it has"],followUp:["How does it compare to other learning techniques?","Would you recommend it to others? Why/Why not?","What do you think is the most important part of learning?"]},speaking_part2_how_you_organize:{topic:"Describe how you organize",questions:["What you do to organize","How often you do it","Why it is important to you","What benefits it has"],followUp:["How does it compare to other organizational techniques?","Would you recommend it to others? Why/Why not?","What do you think is the most important part of organization?"]},speaking_part2_how_you_overcome_adversity:{topic:"Describe how you overcome adversity",questions:["What you do to overcome obstacles","How often you face challenges","Why it is important to you","What benefits it has"],followUp:["How does it compare to other ways of overcoming obstacles?","Would you recommend it to others? Why/Why not?","What do you think is the most important part of overcoming adversity?"]},speaking_part2_how_you_manage_your_time:{topic:"Describe how you manage your time",questions:["What you do to manage your time","How often you do it","Why it is important to you","What benefits it has"],followUp:["How does it compare to other time management techniques?","Would you recommend it to others? Why/Why not?","What do you think is the most important part of time management?"]},speaking_part2_how_you_stay_physically_active:{topic:"Describe how you stay physically active",questions:["What you do to stay active","How often you do it","Why it is important to you","What benefits it has"],followUp:["How does it compare to other ways of staying active?","Would you recommend it to others? Why/Why not?","What do you think is the most important part of staying physically active?"]},speaking_part2_global_politics:{topic:"Describe your views on global politics",questions:["What are the key issues in global politics today?","How do global political decisions affect your country?","What role do international organizations play?","What is your opinion on current global leaders?"],followUp:["How does global politics compare to national politics?","Would you recommend involvement in political discussions? Why/Why not?","What do you think is the most important aspect of global politics?"]},speaking_part2_climate_change_solutions:{topic:"Discuss solutions to climate change",questions:["What are effective solutions for climate change?","How can individuals contribute to these solutions?","Why is it important to act now?","What are the challenges in implementing these solutions?"],followUp:["How do these solutions compare to past efforts?","Would you recommend any specific actions? Why/Why not?","What do you think is the key to successful climate action?"]},speaking_part2_artificial_intelligence:{topic:"Describe the impact of artificial intelligence",questions:["What are the benefits of AI?","How is AI changing industries?","Why is ethical AI development important?","What are potential risks of AI?"],followUp:["How does AI compare to other technological advancements?","Would you encourage learning AI technologies? Why/Why not?","What do you think is the most critical aspect of AI development?"]},speaking_part2_international_trade:{topic:"Discuss the effects of international trade",questions:["What are the benefits and drawbacks of international trade?","How does it affect the economy of your country?","Why is trade balance important?","What are current trends in international trade?"],followUp:["How does international trade compare to domestic trade?","Would you advise engaging in international business? Why/Why not?","What do you think is the most significant factor in trade success?"]},speaking_part2_sustainable_energy:{topic:"Describe the importance of sustainable energy",questions:["What are the advantages of sustainable energy?","How can it be implemented effectively?","Why is it crucial for future generations?","What are the obstacles in transitioning to sustainable energy?"],followUp:["How does sustainable energy compare to fossil fuels?","Would you promote sustainable energy initiatives? Why/Why not?","What do you think is the most pressing energy issue today?"]},speaking_part2_healthcare_reform:{topic:"Discuss the need for healthcare reform",questions:["What are the main challenges in healthcare today?","How can healthcare systems be improved?","Why is access to healthcare important?","What are the potential benefits of reform?"],followUp:["How does healthcare reform compare to current systems?","Would you support changes to healthcare policies? Why/Why not?","What do you think is the most critical issue in healthcare?"]},speaking_part2_urbanization_impact:{topic:"Describe the impact of urbanization",questions:["What are the effects of urbanization on society?","How does it influence the environment?","Why is urban planning important?","What are the challenges urban areas face?"],followUp:["How does urbanization compare to rural development?","Would you recommend living in an urban area? Why/Why not?","What do you think is the most significant urban issue?"]},speaking_part2_gender_equality:{topic:"Discuss the importance of gender equality",questions:["What are the benefits of gender equality?","How can it be promoted in society?","Why is it crucial for development?","What challenges are there in achieving equality?"],followUp:["How does gender equality compare to other social issues?","Would you advocate for gender equality initiatives? Why/Why not?","What do you think is the most important step towards equality?"]},speaking_part2_cybersecurity_threats:{topic:"Describe cybersecurity threats",questions:["What are the major cybersecurity threats today?","How can individuals protect themselves?","Why is cybersecurity important?","What are the challenges in maintaining cybersecurity?"],followUp:["How do cybersecurity threats compare to physical threats?","Would you suggest learning about cybersecurity? Why/Why not?","What do you think is the most critical cybersecurity measure?"]},speaking_part2_global_health_issues:{topic:"Discuss global health issues",questions:["What are the most pressing health issues globally?","How can these issues be addressed?","Why is international cooperation important?","What are the obstacles in resolving global health problems?"],followUp:["How do global health issues compare to local health issues?","Would you support global health initiatives? Why/Why not?","What do you think is the most urgent health issue to tackle?"]},speaking_part2_space_exploration:{topic:"Describe the significance of space exploration",questions:["What are the benefits of exploring space?","How does it impact technology?","Why is it important for humanity?","What are the challenges in space exploration?"],followUp:["How does space exploration compare to other scientific fields?","Would you support funding space missions? Why/Why not?","What do you think is the most exciting aspect of space exploration?"]},speaking_part2_human_rights_advocacy:{topic:"Discuss the importance of human rights advocacy",questions:["What are the key human rights issues today?","How can advocacy be effective?","Why is it important to stand up for human rights?","What challenges do advocates face?"],followUp:["How does human rights advocacy compare to other forms of activism?","Would you participate in human rights campaigns? Why/Why not?","What do you think is the most critical human rights issue?"]},speaking_part2_financial_literacy:{topic:"Describe the importance of financial literacy",questions:["What are the benefits of financial literacy?","How can it be improved in society?","Why is it important for individuals?","What challenges do people face in becoming financially literate?"],followUp:["How does financial literacy compare to other educational topics?","Would you recommend financial education initiatives? Why/Why not?","What do you think is the most important financial skill?"]},speaking_part2_digital_transformation:{topic:"Discuss the impact of digital transformation",questions:["What are the effects of digital transformation on businesses?","How does it change consumer behavior?","Why is it important for competitiveness?","What challenges do companies face in digital transformation?"],followUp:["How does digital transformation compare to past technological shifts?","Would you invest in digital transformation strategies? Why/Why not?","What do you think is the most significant impact of digital transformation?"]},speaking_part2_mental_health_awareness:{topic:"Describe the importance of mental health awareness",questions:["What are the benefits of raising mental health awareness?","How can it be promoted effectively?","Why is it crucial for society?","What challenges exist in addressing mental health issues?"],followUp:["How does mental health awareness compare to physical health awareness?","Would you support mental health initiatives? Why/Why not?","What do you think is the most critical mental health issue?"]},speaking_part2_cultural_preservation:{topic:"Discuss the importance of cultural preservation",questions:["What are the benefits of preserving culture?","How can cultural heritage be protected?","Why is it important for identity?","What are the challenges in cultural preservation?"],followUp:["How does cultural preservation compare to cultural change?","Would you recommend supporting cultural initiatives? Why/Why not?","What do you think is the most significant cultural heritage?"]},speaking_part2_renewable_resources:{topic:"Describe the importance of using renewable resources",questions:["What are the advantages of renewable resources?","How can they be implemented effectively?","Why are they crucial for sustainability?","What challenges exist in adopting renewable resources?"],followUp:["How do renewable resources compare to non-renewable ones?","Would you promote renewable resource usage? Why/Why not?","What do you think is the most promising renewable resource?"]},speaking_part2_social_entrepreneurship:{topic:"Discuss the impact of social entrepreneurship",questions:["What are the benefits of social entrepreneurship?","How does it address societal issues?","Why is it important for community development?","What challenges do social entrepreneurs face?"],followUp:["How does social entrepreneurship compare to traditional business models?","Would you invest in social enterprises? Why/Why not?","What do you think is the most impactful social enterprise?"]},speaking_part2_art_and_society:{topic:"Describe the relationship between art and society",questions:["What role does art play in society?","How does it reflect cultural values?","Why is artistic expression important?","What challenges do artists face today?"],followUp:["How does art compare to other forms of cultural expression?","Would you support public art projects? Why/Why not?","What do you think is the most influential art movement?"]},speaking_part2_digital_privacy:{topic:"Discuss the importance of digital privacy",questions:["What are the major concerns regarding digital privacy?","How can individuals protect their privacy online?","Why is privacy important in the digital age?","What challenges exist in ensuring digital privacy?"],followUp:["How does digital privacy compare to traditional privacy?","Would you advocate for stronger privacy regulations? Why/Why not?","What do you think is the most significant digital privacy issue?"]}}).map(e=>{let[t,a]=e;return{id:t,title:a.topic,titleVi:"Phần 2 - "+a.topic,titleEn:"Part 2 - "+a.topic,description:"Long turn speaking practice with cue card",descriptionVi:"Luyện tập n\xf3i d\xe0i với thẻ gợi \xfd",descriptionEn:"Long turn speaking practice with cue card",systemPrompt:"Describe the following topic using the cue card.",taskType:"task2",level:"B2",targetBand:"6.0-7.0",criteria:["task_response","coherence_cohesion","lexical_resource","grammatical_range"],topics:["long_turn_speaking","cue_card","description"],tags:["long_turn","cue_card"],objectives:["Improve fluency in long turn speaking","Expand vocabulary related to the topic","Practice structured description","Build confidence in speaking"],part:"PART2",topic:a.topic}}),...Object.entries({speaking_part3_education_system:["What are the main problems with the education system in your country?","How has education changed in the last 20 years?","What role should technology play in education?","Do you think traditional teaching methods are still effective?","How can schools better prepare students for the future?"],speaking_part3_online_learning:["What are the advantages and disadvantages of online learning?","Do you think online education will replace traditional classrooms?","How has technology changed the way people learn?","What skills are important for successful online learning?","How can online education be improved?"],speaking_part3_technology_impact:["How has technology changed the way people work?","What are the negative effects of technology on society?","Do you think people rely too much on technology?","How might technology affect employment in the future?","What can be done to protect privacy in the digital age?"],speaking_part3_environmental_issues:["What are the main environmental problems in your country?","How can individuals help protect the environment?","Do you think governments are doing enough to address climate change?","What role should businesses play in environmental protection?","How might environmental problems affect future generations?"],speaking_part3_social_media:["How has social media changed the way we communicate?","What are the positive and negative effects of social media?","Do you think social media influences public opinion?","How can social media be used for educational purposes?","What measures can be taken to protect privacy on social media?"],speaking_part3_climate_change:["What are the main causes of climate change?","How does climate change affect your country?","What can individuals do to combat climate change?","Do you think governments are doing enough to address climate change?","What role do businesses play in climate change mitigation?"],speaking_part3_artificial_intelligence:["How is artificial intelligence changing the job market?","What are the ethical considerations of AI development?","Do you think AI will surpass human intelligence?","How can AI be used to improve healthcare?","What are the potential risks of AI?"],speaking_part3_globalization:["How has globalization affected your country?","What are the benefits and drawbacks of globalization?","Do you think globalization is inevitable?","How does globalization influence cultural exchange?","What impact does globalization have on local businesses?"],speaking_part3_renewable_energy:["What are the advantages of renewable energy sources?","How can governments promote the use of renewable energy?","Do you think renewable energy can replace fossil fuels?","What are the challenges of implementing renewable energy?","How does renewable energy impact the environment?"],speaking_part3_education_reform:["What changes would you like to see in the education system?","How can technology improve education?","What role should teachers play in modern education?","Do you think exams are an effective way to assess students?","How can education be made more accessible to all?"],speaking_part3_mental_health:["Why is mental health important?","How can society reduce the stigma around mental health issues?","What are the signs of good mental health?","How can individuals maintain their mental health?","What role does the government play in mental health care?"],speaking_part3_space_exploration:["What are the benefits of space exploration?","Do you think humans will live on other planets in the future?","How does space exploration impact scientific research?","What are the challenges of space travel?","How can space exploration benefit the economy?"],speaking_part3_technology_innovation:["What are some recent technological innovations?","How do technological advancements affect society?","Do you think technology is advancing too quickly?","How can innovation be encouraged in the tech industry?","What are the ethical implications of new technologies?"],speaking_part3_economic_inequality:["What are the causes of economic inequality?","How does economic inequality affect society?","What measures can be taken to reduce economic inequality?","Do you think wealth should be redistributed?","How can education help reduce economic inequality?"],speaking_part3_healthcare_reform:["What changes would you like to see in the healthcare system?","How can technology improve healthcare?","What role should governments play in healthcare?","Do you think healthcare should be free?","What measures can be taken to reduce healthcare costs?"],speaking_part3_space_colonization:["What are the benefits of colonizing other planets?","Do you think humans will colonize other planets?","How does space colonization impact the economy?","What are the challenges of space colonization?","How can space colonization help humanity?"],speaking_part3_artificial_intelligence_ethics:["What are the ethical implications of AI development?","How can AI be used to benefit society?","Do you think AI should be regulated?","What are the potential risks of AI?","How can AI be used to improve education?"],speaking_part3_climate_change_impacts:["What are the main impacts of climate change?","How does climate change affect different regions?","What can individuals do to combat climate change?","Do you think governments are doing enough to address climate change?","What role do businesses play in climate change mitigation?"],speaking_part3_social_media_impact:["How has social media changed the way we communicate?","What are the positive and negative effects of social media?","Do you think social media influences public opinion?","How can social media be used for educational purposes?","What measures can be taken to protect privacy on social media?"]}).map(e=>{let[t,a]=e,i=t.split("_").pop()||"";return{id:t,title:i.charAt(0).toUpperCase()+i.slice(1),titleVi:"Phần 3 - "+i.charAt(0).toUpperCase()+i.slice(1),titleEn:"Part 3 - "+i.charAt(0).toUpperCase()+i.slice(1),description:"Discussion of abstract ideas and complex topics",descriptionVi:"Thảo luận về c\xe1c \xfd tưởng trừu tượng v\xe0 chủ đề phức tạp",descriptionEn:"Discussion of abstract ideas and complex topics",systemPrompt:"Discuss the following topic.",taskType:"task2",level:"C1",targetBand:"7.0-8.0",criteria:["task_response","coherence_cohesion","lexical_resource","grammatical_range"],topics:["abstract_ideas","complex_topics","discussion"],tags:["abstract","complex","discussion"],objectives:["Improve ability to discuss abstract ideas","Develop complex topic discussion skills","Enhance critical thinking","Build confidence in speaking"],part:"PART3",topic:i}}),...Object.entries({speaking_advanced_debate:{topics:["The Impact of Social Media on Democracy","Universal Basic Income","Artificial Intelligence Ethics","Climate Change Solutions","Future of Work","Space Exploration Prospects","Renewable Energy Adoption","Education System Overhaul","Mental Health Awareness","Economic Inequality Challenges","Cultural Heritage Preservation","Globalization Effects","Healthcare System Improvements","Technological Innovation and Society","Privacy in the Digital Age","Global Trade Dynamics","Sustainable Urban Development","Food Security Concerns","Water Resource Management","Biodiversity Conservation","Human Rights Advocacy","International Relations and Diplomacy","Cybersecurity Threats","Artificial Intelligence in Healthcare","Public Transport Efficiency","Financial Literacy Education","Work-Life Balance Strategies","Agricultural Innovations","Tourism Industry Trends","Media Influence on Public Opinion","Youth Empowerment Initiatives","Aging Population Challenges","Disaster Preparedness and Response","Corporate Social Responsibility","Digital Divide Solutions","Renewable Energy Technologies","Space Tourism Possibilities","Blockchain Technology Applications","Virtual Reality in Education","Gender Equality Movements","Animal Welfare Policies","Cultural Exchange Programs","Urbanization and Its Impact","Nuclear Energy Debate","Artificial Intelligence in Art","Climate Change Adaptation","Renewable Energy Investments","Global Health Initiatives","Online Learning Platforms","Smart City Developments","Crisis Management Strategies","Environmental Sustainability","Immigration Policy Debates","Cryptocurrency Impact","Robotics and Automation","Biotechnology Breakthroughs","Social Media Regulation","Global Economic Trends","Artificial Intelligence in Law Enforcement","Cybersecurity Governance","Healthcare Innovation","Virtual Reality in Healthcare","Sustainable Agriculture","Transportation Infrastructure Development","Education Technology Advancements","Disaster Risk Reduction","Corporate Governance","Data Privacy and Protection","Global Food Security","Renewable Energy Grid Integration","Climate Change Mitigation Strategies","Digital Literacy Education","Robotics and Artificial Intelligence in Manufacturing","Biotechnology in Medicine","Cybersecurity and Critical Infrastructure","Online Learning Personalization","Smart City Infrastructure","Financial Inclusion Initiatives","Global Supply Chain Management","Artificial Intelligence in Education","Virtual Reality in Training","Immigration and Border Control","Cryptocurrency Regulation","Robotics and Automation in Industry","Biotechnology in Agriculture","Social Media Impact on Society","Global Economic Development","Artificial Intelligence in Cybersecurity","Cybersecurity Compliance","Healthcare Innovation and Technology","Virtual Reality in Entertainment","Sustainable Resource Management","Transportation Infrastructure Financing","Education Technology Innovation","Disaster Risk Reduction and Management","Corporate Social Responsibility and Sustainability","Data Protection and Privacy","Global Food Production and Distribution","Renewable Energy Policy and Regulation","Climate Change Adaptation and Resilience","Digital Literacy and Skills Training","Robotics and Artificial Intelligence in Healthcare","Biotechnology in Renewable Energy","Cybersecurity and Cybercrime","Online Learning Accessibility","Smart City Sustainability"],format:{preparation:"2 minutes",speaking:"4 minutes",discussion:"5 minutes"},criteria:["Argument Development","Critical Analysis","Evidence Use","Rebuttal Skills"]},speaking_advanced_case_study:{topics:["A Company's Response to a Crisis","A Successful Business Strategy","A Social Media Campaign","A Product Launch","A Change Management Process","A Marketing Campaign","A New Business Venture","A Public Relations Crisis","A Product Recall","A Merger or Acquisition","A Rebranding Effort","A Sustainability Initiative","A Diversity and Inclusion Program","A Talent Management Strategy","A Supply Chain Optimization","A Digital Transformation","A Cloud Computing Adoption","A Cybersecurity Breach","A Disaster Recovery Plan","A Business Continuity Plan","A Risk Management Strategy"],format:{preparation:"5 minutes",speaking:"10 minutes",discussion:"10 minutes"},criteria:["Analytical Thinking","Problem Solving","Communication Skills","Business Acumen"]},speaking_advanced_problem_solving:{topics:["A Supply Chain Disruption","A Cybersecurity Threat","A Public Health Crisis","A Natural Disaster","A Financial Crisis","A Regulatory Change","A Shift in Consumer Behavior","A Technological Advancement","A Change in Global Economic Trends","A Shift in Global Power Dynamics","A Pandemic","A Climate Change Related Event","A Geopolitical Crisis","A Refugee Crisis","A Humanitarian Crisis","A Global Health Threat","A Food Security Crisis","A Water Security Crisis","A Global Economic Downturn","A Global Financial Crisis","A Global Trade War"],format:{preparation:"5 minutes",speaking:"10 minutes",discussion:"10 minutes"},criteria:["Critical Thinking","Creative Problem Solving","Decision Making","Collaboration and Communication"]},speaking_advanced_data_analysis:{topics:["Analyze a Company's Financial Statement","Analyze a Company's Marketing Strategy","Analyze a Company's Human Resources Management","Analyze a Company's Operations Management","Analyze a Company's Supply Chain Management","Analyze a Company's Information Technology Management","Analyze a Company's Financial Performance","Analyze a Company's Competitor Analysis","Analyze a Company's Market Research","Analyze a Company's Product Development","Analyze a Company's Brand Management","Analyze a Company's Digital Marketing Strategy","Analyze a Company's Social Media Strategy","Analyze a Company's Public Relations Strategy","Analyze a Company's Crisis Management Strategy","Analyze a Company's Sustainability Strategy","Analyze a Company's Corporate Social Responsibility Strategy","Analyze a Company's Diversity and Inclusion Strategy","Analyze a Company's Talent Management Strategy","Analyze a Company's Global Strategy","Analyze a Company's Competitive Advantage"],format:{preparation:"5 minutes",speaking:"10 minutes",discussion:"10 minutes"},criteria:["Data Analysis","Data Interpretation","Data Visualization","Communication Skills"]}}).map(e=>{let[t,a]=e,i=t.split("_").pop()||"";return{id:t,title:i.charAt(0).toUpperCase()+i.slice(1),titleVi:"N\xe2ng cao - "+i.charAt(0).toUpperCase()+i.slice(1),titleEn:"Advanced - "+i.charAt(0).toUpperCase()+i.slice(1),description:"Complex discussion topics for high-level practice",descriptionVi:"Thảo luận về c\xe1c chủ đề phức tạp cho luyện tập n\xe2ng cao",descriptionEn:"Complex discussion topics for high-level practice",systemPrompt:"Discuss the following advanced topic.",taskType:"task2",level:"C1",targetBand:"7.0-8.5",criteria:["task_response","coherence_cohesion","lexical_resource","grammatical_range"],topics:["advanced_topics","complex_discussion","high_level"],tags:["advanced","complex","high_level"],objectives:["Master complex topic discussions","Develop high-level communication skills","Enhance abstract thinking","Build confidence in speaking"],part:"PART3",topic:i}})];var D=a(76),C=a(9430),H=a(6967);function N(e){let{userId:t,onSessionSelect:a,currentSessionId:o}=e,[s,r]=(0,n.useState)(null),[l,c]=(0,n.useState)([]);return(0,n.useEffect)(()=>{r(W.getHistory(t)),c(W.getRecentSessions(t,10))},[t,o]),(0,i.jsxs)("div",{className:"w-full h-full flex flex-col space-y-4",children:[(0,i.jsxs)(d.Zp,{children:[(0,i.jsx)(d.aR,{children:(0,i.jsx)(d.ZB,{children:"Thống k\xea tổng qu\xe1t"})}),(0,i.jsx)(d.Wu,{children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{children:"Tổng số phi\xean:"}),(0,i.jsx)("span",{className:"font-medium",children:(null==s?void 0:s.stats.totalSessions)||0})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{children:"Band trung b\xecnh:"}),(0,i.jsx)("span",{className:"font-medium",children:(null==s?void 0:s.stats.averageBand.toFixed(1))||"N/A"})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{children:"Thời gian luyện tập:"}),(0,i.jsxs)("span",{className:"font-medium",children:[(null==s?void 0:s.stats.timeSpent)||0," ph\xfat"]})]}),(null==s?void 0:s.stats.lastSessionDate)&&(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{children:"Phi\xean gần nhất:"}),(0,i.jsx)("span",{className:"font-medium",children:(0,D.m)(s.stats.lastSessionDate,{addSuffix:!0,locale:C.vi})})]})]})})]}),(0,i.jsxs)(d.Zp,{className:"flex-1",children:[(0,i.jsx)(d.aR,{children:(0,i.jsx)(d.ZB,{children:"Phi\xean gần đ\xe2y"})}),(0,i.jsx)(d.Wu,{children:(0,i.jsx)("div",{className:"space-y-2",children:l.map(e=>{var t;return(0,i.jsxs)(h.$,{variant:e.id===o?"secondary":"ghost",className:"w-full justify-between",onClick:()=>a(e),children:[(0,i.jsxs)("div",{className:"flex flex-col items-start",children:[(0,i.jsx)("span",{className:"text-sm font-medium",children:(0,D.m)(e.startTime,{addSuffix:!0,locale:C.vi})}),(0,i.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Band: ",(null===(t=e.metrics)||void 0===t?void 0:t.overallBand)||"N/A"]})]}),(0,i.jsx)(H.A,{className:"h-4 w-4"})]},e.id)})})})]})]})}var I=a(3900),E=a(8283),P=a(3550);function R(e){let{content:t,role:a}=e;return"user"===a?(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)("div",{className:"max-w-[80%] p-3 rounded-lg bg-blue-500 text-white",children:t})}):(0,i.jsx)("div",{className:"flex justify-start",children:(0,i.jsx)(d.Zp,{className:"max-w-[80%] p-4 prose prose-sm dark:prose-invert",children:(0,i.jsx)(P.o,{children:t})})})}function M(e){let{messages:t,onSendMessage:a,isProcessing:o}=e,[s,r]=(0,n.useState)("");return(0,i.jsx)(d.Zp,{className:"h-full flex flex-col",children:(0,i.jsxs)(d.Wu,{className:"flex-1 p-4 flex flex-col",children:[(0,i.jsx)("div",{className:"flex-1 overflow-y-auto space-y-4",children:t.map((e,t)=>(0,i.jsx)(R,{role:e.role,content:e.content},t))}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s.trim()&&!o&&(a(s.trim()),r(""))},className:"mt-4 flex gap-2",children:[(0,i.jsx)(I.p,{value:s,onChange:e=>r(e.target.value),placeholder:"Nhập c\xe2u hỏi của bạn...",disabled:o}),(0,i.jsx)(h.$,{type:"submit",disabled:o||!s.trim(),children:(0,i.jsx)(E.A,{className:"h-4 w-4"})})]})]})})}var U=a(2413);let q=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)(U.bL,{className:(0,s.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...n,ref:t,children:(0,i.jsx)(U.zi,{className:(0,s.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});q.displayName=U.bL.displayName;var B=a(8986),L=a(1536);function z(e){let{onAudioSubmit:t,onAnalysisComplete:a,onRecordingComplete:o,onRecordingStop:s,isHandsFree:r=!1,disabled:l=!1,audioBlob:c=null}=e,[u,d]=(0,n.useState)(!1),[p,m]=(0,n.useState)(!1),[y,g]=(0,n.useState)(null),[f,v]=(0,n.useState)(!0),[b,x]=(0,n.useState)(null),w=(0,n.useRef)(null),_=(0,n.useRef)([]),k=(0,n.useRef)(null),W=(0,n.useRef)(null);(0,n.useEffect)(()=>()=>{y&&URL.revokeObjectURL(y)},[y]);let S=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});k.current=new AudioContext,W.current=k.current.createAnalyser(),k.current.createMediaStreamSource(e).connect(W.current),w.current=new MediaRecorder(e),_.current=[],w.current.ondataavailable=e=>{_.current.push(e.data)},w.current.onstop=()=>{T()},w.current.start(),d(!0),m(!1),f&&j()}catch(e){console.error("Error accessing microphone:",e)}},j=()=>{if(!W.current)return;let e=W.current.frequencyBinCount,t=new Float32Array(e),a=null,i=()=>{if(W.current&&u&&!p){if(W.current.getFloatTimeDomainData(t),20*Math.log10(Math.sqrt(t.reduce((e,t)=>e+t*t,0)/e))<-50){if(a){if(Date.now()-a>5e3){A();return}}else a=Date.now()}else a=null;requestAnimationFrame(i)}};requestAnimationFrame(i)},A=()=>{w.current&&u&&(w.current.stop(),w.current.stream.getTracks().forEach(e=>e.stop()),d(!1),m(!1),null==s||s())},T=async()=>{let e=new Blob(_.current,{type:"audio/wav"});g(URL.createObjectURL(e)),o?await o(e):t&&t(e)};return(0,i.jsxs)("div",{className:"flex flex-col gap-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",children:[(0,i.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(q,{checked:f,onCheckedChange:v,id:"auto-mode"}),(0,i.jsx)(B.J,{htmlFor:"auto-mode",children:"Tự động dừng sau 5 gi\xe2y im lặng"})]})}),(0,i.jsx)("div",{className:"flex items-center gap-4",children:(0,i.jsxs)(h.$,{onClick:u?A:S,disabled:l,variant:u?"destructive":"default",children:[u?(0,i.jsx)(L.wFo,{className:"mr-2"}):(0,i.jsx)(L.i0t,{className:"mr-2"}),u?"Stop":"Record"]})}),y&&!u&&(0,i.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,i.jsxs)(h.$,{onClick:()=>{y&&new Audio(y).play()},variant:"outline",children:[(0,i.jsx)(L.gSK,{className:"mr-2"})," Nghe lại"]}),(0,i.jsx)(h.$,{onClick:()=>{if(y&&_.current.length>0){let e=new Blob(_.current,{type:"audio/wav"});null==t||t(e),g(null),_.current=[]}},variant:"default",children:"Gửi"}),(0,i.jsxs)(h.$,{onClick:()=>{y&&(URL.revokeObjectURL(y),g(null),_.current=[])},variant:"destructive",children:[(0,i.jsx)(L.qbC,{className:"mr-2"})," X\xf3a"]})]})]})}var O=a(7223),F=a(6217);let G=F.bL;F.l9;let V=F.ZL,Y=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)(F.hJ,{ref:t,className:(0,s.cn)("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n})});Y.displayName=F.hJ.displayName;let Z=n.forwardRef((e,t)=>{let{className:a,children:n,...o}=e;return(0,i.jsxs)(V,{children:[(0,i.jsx)(Y,{}),(0,i.jsx)(F.UC,{ref:t,className:(0,s.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:n})]})});Z.displayName=F.UC.displayName;let J=e=>{let{className:t,...a}=e;return(0,i.jsx)("div",{className:(0,s.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};J.displayName="DialogHeader";let K=e=>{let{className:t,...a}=e;return(0,i.jsx)("div",{className:(0,s.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};K.displayName="DialogFooter";let $=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)(F.hE,{ref:t,className:(0,s.cn)("text-lg font-semibold leading-none tracking-tight",a),...n})});$.displayName=F.hE.displayName;let Q=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)(F.VY,{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",a),...n})});Q.displayName=F.VY.displayName;var X=a(9173);function ee(e){let{onSessionEnd:t}=e,[a,o]=(0,n.useState)(0),[s,r]=(0,n.useState)(100);return(0,n.useEffect)(()=>{let e=setInterval(()=>{o(A.getTimeRemaining());let a=A.getCurrentSession();if(a){let i=6e4*a.duration,n=Date.now()-a.startTime;r(Math.max(0,Math.min(100,(i-n)/i*100))),n>=i&&t&&(t(),clearInterval(e))}},1e3);return()=>clearInterval(e)},[t]),(0,i.jsx)(d.Zp,{children:(0,i.jsx)(d.Wu,{className:"py-4",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,i.jsx)("span",{className:"font-medium",children:"Session Progress"}),(0,i.jsx)("span",{className:a<=6e4?"text-red-500 font-medium":"",children:(e=>{let t=Math.floor(e/6e4),a=Math.floor(e%6e4/1e3);return"".concat(t,":").concat(a.toString().padStart(2,"0"))})(a)})]}),(0,i.jsx)(X.k,{value:s})]})})})}var et=a(6046);let ea=e=>["task1","task2","task3"].includes(e);function ei(){let[e,t]=(0,n.useState)("templates"),[a,o]=(0,n.useState)([]),[s,p]=(0,n.useState)(""),[m,y]=(0,n.useState)(null),[g,f]=(0,n.useState)(!1),[v,b]=(0,n.useState)(null),[x,w]=(0,n.useState)(!1),[_,k]=(0,n.useState)(15),[W,S]=(0,n.useState)(!1),[j,D]=(0,n.useState)(null),{toast:C}=(0,O.dj)(),H="test-user",E=(0,et.useRouter)(),P=async e=>{if(e.trim()&&m)try{f(!0),await A.sendMessage(e);let t=A.getCurrentSession();if(t&&Array.isArray(t.messages)){o([...t.messages]);let e={id:t.id,userId:H,templateId:(null==v?void 0:v.id)||"default-template",startTime:t.startTime,endTime:t.endTime,messages:t.messages,duration:t.duration||5,audioUrls:t.audioUrls||[]};y(e)}}catch(e){console.error("Error sending message:",e),C({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}finally{f(!1),p("")}},R=async e=>{try{if(!m)return;let t=A.getCurrentSession();if(t&&Array.isArray(t.messages)){o([...t.messages]);let a={id:t.id,userId:H,templateId:(null==v?void 0:v.id)||"default-template",startTime:t.startTime,endTime:t.endTime,messages:t.messages,duration:t.duration||5,audioUrls:t.audioUrls||[]};y(a),(e.includes("Pronunciation:")||e.includes("Grammar:")||e.includes("Vocabulary:")||e.includes("Fluency:"))&&D(e)}}catch(e){console.error("Error processing audio response:",e),C({title:"Error",description:"Failed to process audio response. Please try again.",variant:"destructive"})}},U=async e=>{b(e),w(!0);let a=await F();a&&(k(a),S(!0),o((await A.startSession("template",a,e)).messages),t("practice"))},q=async()=>{try{m&&await A.endSession(m);let e=await A.startSession(v?"template":"tutor",_,v||void 0),a={id:e.id,userId:H,templateId:(null==v?void 0:v.id)||"default-template",startTime:e.startTime,endTime:e.endTime,messages:e.messages,duration:e.duration||5,audioUrls:e.audioUrls||[]};y(a),o(e.messages),S(!0),w(!1),t("practice"),C({title:"Session Started",description:"Your ".concat(_,"-minute speaking practice session has begun.")})}catch(e){console.error("Error starting practice:",e),C({title:"Error",description:"Failed to start practice session. Please try again.",variant:"destructive"})}},L=async()=>{try{if(!m)return null;let e={...m,endTime:Date.now()},t=await A.endSession(e);return t&&(y(null),o([]),S(!1),b(null),C({title:"Session Complete",description:"Your speaking practice session has ended."}),E.push("/agents/speaking/results?metrics=".concat(encodeURIComponent(JSON.stringify(t.metrics))))),t}catch(e){return console.error("Error ending session:",e),C({title:"Session Error",description:"There was an issue ending your speaking practice session.",variant:"destructive"}),null}},F=async()=>new Promise(e=>{let t=t=>{w(!1),e(t)};w(!0),setTimeout(()=>{t(15)},1e3)});return(0,n.useEffect)(()=>()=>{m&&A.endSession(m).catch(console.error)},[m]),(0,i.jsxs)("div",{className:"container mx-auto p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[(0,i.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[(0,i.jsx)("div",{className:"col-span-3",children:(0,i.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-[inset_-12px_-8px_40px_#46464620] hover:shadow-[inset_-12px_-8px_40px_#46464620,_12px_8px_20px_#46464620] transition-all duration-300",children:(0,i.jsx)(N,{userId:H,onSessionSelect:e=>{y(e),e.messages&&o(e.messages)},currentSessionId:null==m?void 0:m.id})})}),(0,i.jsx)("div",{className:"col-span-9",children:(0,i.jsxs)(r,{defaultValue:"templates",className:"w-full",children:[(0,i.jsxs)(l,{children:[(0,i.jsx)(c,{value:"templates",children:"Templates"}),(0,i.jsx)(c,{value:"practice",children:"Practice"}),(0,i.jsx)(c,{value:"feedback",children:"Feedback"}),(0,i.jsx)(c,{value:"results",children:"Results"})]}),(0,i.jsx)(u,{value:"templates",children:(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map(e=>(0,i.jsxs)(d.Zp,{className:"cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 bg-white dark:bg-gray-800 shadow-[5px_5px_10px_#b8b9be,_-5px_-5px_10px_#ffffff] hover:shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff]",onClick:()=>U(e),children:[(0,i.jsxs)(d.aR,{children:[(0,i.jsx)(d.ZB,{children:e.title}),(0,i.jsx)(d.BT,{children:e.description})]}),(0,i.jsxs)(d.Wu,{children:[(0,i.jsxs)("p",{children:["Level: ",e.level]}),(0,i.jsxs)("p",{children:["Target Band: ",e.targetBand]}),(0,i.jsxs)("p",{children:["Criteria: ",e.criteria.join(", ")]})]})]},e.id))})}),(0,i.jsx)(u,{value:"practice",children:v?(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-[inset_-12px_-8px_40px_#46464620]",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-2xl font-bold",children:v.title}),(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:v.description})]}),(0,i.jsx)(h.$,{variant:"outline",onClick:()=>{b(null),o([]),w(!0)},className:"rounded-xl bg-white hover:bg-gray-50 shadow-[5px_5px_10px_#b8b9be,_-5px_-5px_10px_#ffffff] hover:shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff] transition-all duration-300",children:"New Session"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[(0,i.jsxs)("div",{className:"p-4 rounded-xl bg-gray-50 dark:bg-gray-700 shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff]",children:[(0,i.jsx)("p",{className:"text-sm font-medium",children:"Level"}),(0,i.jsx)("p",{className:"text-lg",children:v.level})]}),(0,i.jsxs)("div",{className:"p-4 rounded-xl bg-gray-50 dark:bg-gray-700 shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff]",children:[(0,i.jsx)("p",{className:"text-sm font-medium",children:"Target Band"}),(0,i.jsx)("p",{className:"text-lg",children:v.targetBand})]}),(0,i.jsxs)("div",{className:"p-4 rounded-xl bg-gray-50 dark:bg-gray-700 shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff]",children:[(0,i.jsx)("p",{className:"text-sm font-medium",children:"Part"}),(0,i.jsx)("p",{className:"text-lg",children:v.taskType.replace("speaking_","").toUpperCase()})]})]})]}),(0,i.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-[inset_-12px_-8px_40px_#46464620]",children:[W&&(0,i.jsx)("div",{className:"mb-4",children:(0,i.jsx)(ee,{onSessionEnd:L})}),(0,i.jsx)(M,{messages:a,onSendMessage:P,isProcessing:g}),(0,i.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:(0,i.jsx)(z,{onAnalysisComplete:R,isHandsFree:!1})})]})]}):(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"text-center space-y-2 mb-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold",children:"IELTS Speaking Practice"}),(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Choose a template or start a free chat with AI tutor"})]}),(0,i.jsx)("div",{className:"mb-8",children:(0,i.jsxs)(d.Zp,{className:"cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 bg-white dark:bg-gray-800 shadow-[5px_5px_10px_#b8b9be,_-5px_-5px_10px_#ffffff] hover:shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff] transition-all duration-300",onClick:()=>{let e=T.find(e=>"task1"===e.taskType);e&&U(e)},children:[(0,i.jsxs)(d.aR,{children:[(0,i.jsx)(d.ZB,{children:"Tr\xf2 chuyện tự do"}),(0,i.jsx)(d.BT,{children:"Tr\xf2 chuyện tự do với AI tutor để luyện tập tiếng Anh"})]}),(0,i.jsx)(d.Wu,{children:(0,i.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,i.jsx)("span",{children:"Level: All Levels"}),(0,i.jsx)("span",{children:"Free Practice"})]})})]})}),(0,i.jsxs)(r,{defaultValue:"part1",className:"w-full",children:[(0,i.jsxs)(l,{className:"grid w-full grid-cols-4 mb-8 p-1 bg-white dark:bg-gray-800 rounded-xl shadow-[5px_5px_10px_#b8b9be,_-5px_-5px_10px_#ffffff]",children:[(0,i.jsx)(c,{value:"part1",className:"data-[state=active]:shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff] rounded-lg",children:"Part 1"}),(0,i.jsx)(c,{value:"part2",className:"data-[state=active]:shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff] rounded-lg",children:"Part 2"}),(0,i.jsx)(c,{value:"part3",className:"data-[state=active]:shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff] rounded-lg",children:"Part 3"}),(0,i.jsx)(c,{value:"advanced",className:"data-[state=active]:shadow-[inset_5px_5px_10px_#b8b9be,_inset_-5px_-5px_10px_#ffffff] rounded-lg",children:"Advanced"})]}),["part1","part2","part3","advanced"].map(e=>(0,i.jsx)(u,{value:e,children:(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.filter(t=>ea(t.taskType)&&t.taskType==="task".concat(e.replace("part",""))).map(e=>(0,i.jsxs)(d.Zp,{className:"cursor-pointer transition-all duration-300 transform hover:-translate-y-1 bg-white dark:bg-gray-800 shadow-[5px_5px_10px_#b8b9be,_-5px_-5px_10px_#ffffff] hover:shadow-[8px_8px_15px_#b8b9be,_-8px_-8px_15px_#ffffff]",onClick:()=>{e&&U(e)},children:[(0,i.jsxs)(d.aR,{children:[(0,i.jsx)(d.ZB,{children:e.title}),(0,i.jsx)(d.BT,{children:e.description})]}),(0,i.jsxs)(d.Wu,{children:[(0,i.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,i.jsxs)("span",{children:["Level: ",e.level]}),(0,i.jsxs)("span",{children:["Target: Band ",e.targetBand]})]}),(0,i.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:e.criteria.map((e,t)=>(0,i.jsx)("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-700 shadow-[inset_2px_2px_5px_#b8b9be,_inset_-2px_-2px_5px_#ffffff]",children:e},t))})]})]},e.id))})},e))]})]})}),(0,i.jsx)(u,{value:"feedback"}),(0,i.jsx)(u,{value:"results"})]})})]}),(0,i.jsx)(G,{open:x,onOpenChange:w,children:(0,i.jsxs)(Z,{children:[(0,i.jsxs)(J,{children:[(0,i.jsx)($,{children:"Chọn thời gian luyện tập"}),(0,i.jsx)(Q,{children:"Bạn muốn d\xe0nh bao nhi\xeau ph\xfat cho phi\xean luyện tập n\xe0y? (5-30 ph\xfat)"})]}),(0,i.jsx)("div",{className:"grid gap-4 py-4",children:(0,i.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,i.jsx)(B.J,{htmlFor:"duration",className:"text-right",children:"Thời gian (ph\xfat)"}),(0,i.jsx)(I.p,{id:"duration",type:"number",min:5,max:30,value:_,onChange:e=>k(parseInt(e.target.value)),className:"col-span-3"})]})}),(0,i.jsx)(K,{children:(0,i.jsx)(h.$,{onClick:q,children:"Bắt đầu"})})]})})]})}},3312:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var i=a(5155),n=a(2115),o=a(2317),s=a(1027),r=a(1567);let l=(0,s.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-slate-100 text-slate-900 shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff] active:shadow-[inset_6px_6px_12px_#b8b9be,inset_-6px_-6px_12px_#ffffff] hover:shadow-[4px_4px_8px_#b8b9be,-4px_-4px_8px_#ffffff]",destructive:"bg-red-100 text-red-900 shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff] active:shadow-[inset_6px_6px_12px_#b8b9be,inset_-6px_-6px_12px_#ffffff] hover:shadow-[4px_4px_8px_#b8b9be,-4px_-4px_8px_#ffffff]",outline:"border border-slate-200 bg-slate-100 shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff] active:shadow-[inset_6px_6px_12px_#b8b9be,inset_-6px_-6px_12px_#ffffff] hover:shadow-[4px_4px_8px_#b8b9be,-4px_-4px_8px_#ffffff]",secondary:"bg-slate-200 text-slate-900 shadow-[6px_6px_12px_#b8b9be,-6px_-6px_12px_#ffffff] active:shadow-[inset_6px_6px_12px_#b8b9be,inset_-6px_-6px_12px_#ffffff] hover:shadow-[4px_4px_8px_#b8b9be,-4px_-4px_8px_#ffffff]",ghost:"hover:bg-slate-100 hover:text-slate-900",link:"text-slate-900 underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:a,variant:n,size:s,asChild:c=!1,...u}=e,h=c?o.DX:"button";return(0,i.jsx)(h,{className:(0,r.cn)(l({variant:n,size:s,className:a})),ref:t,...u})});c.displayName="Button"},9749:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>u,ZB:()=>l,Zp:()=>s,aR:()=>r});var i=a(5155),n=a(2115),o=a(1567);let s=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...n})});s.displayName="Card";let r=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...n})});r.displayName="CardHeader";let l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...n})});c.displayName="CardDescription";let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",a),...n})});u.displayName="CardContent",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",a),...n})}).displayName="CardFooter"},3900:(e,t,a)=>{"use strict";a.d(t,{p:()=>s});var i=a(5155),n=a(2115),o=a(1567);let s=n.forwardRef((e,t)=>{let{className:a,type:n,...s}=e;return(0,i.jsx)("input",{type:n,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s})});s.displayName="Input"},8986:(e,t,a)=>{"use strict";a.d(t,{J:()=>r});var i=a(5155),n=a(2115),o=a(6195),s=a(1567);let r=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,i.jsx)(o.b,{ref:t,className:(0,s.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",a),...n})});r.displayName=o.b.displayName},9173:(e,t,a)=>{"use strict";a.d(t,{k:()=>r});var i=a(5155),n=a(2115),o=a(4681),s=a(1567);let r=n.forwardRef((e,t)=>{let{className:a,value:n,...r}=e;return(0,i.jsx)(o.bL,{ref:t,className:(0,s.cn)("relative h-2 w-full overflow-hidden rounded-full bg-slate-100",a),...r,children:(0,i.jsx)(o.C1,{className:"h-full w-full flex-1 bg-gradient-to-r from-blue-600 to-cyan-500 transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});r.displayName="Progress"},7223:(e,t,a)=>{"use strict";a.d(t,{dj:()=>d});var i=a(2115);let n=0,o=new Map,s=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},r=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?s(a):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function u(e){c=r(c,e),l.forEach(e=>{e(c)})}function h(e){let{...t}=e,a=(n=(n+1)%Number.MAX_VALUE).toString(),i=()=>u({type:"DISMISS_TOAST",toastId:a});return u({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||i()}}}),{id:a,dismiss:i,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function d(){let[e,t]=i.useState(c);return i.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:h,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},1567:(e,t,a)=>{"use strict";a.d(t,{cn:()=>o});var i=a(3463),n=a(9795);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,i.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[711,365,679,910,271,788,644,441,517,358],()=>t(3361)),_N_E=e.O()}]);